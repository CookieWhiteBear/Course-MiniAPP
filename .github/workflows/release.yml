name: Create Release

on:
  push:
    tags:
      - 'v*'  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push —Ç–µ–≥–∞ —Ç–∏–ø–∞ v1.0.0

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies (root)
        run: npm install

      - name: Install dependencies (server)
        run: cd server && npm install

      - name: Build project
        run: node build-deploy.js

      - name: Create release archive
        run: |
          cd pterodactyl
          zip -r ../pterodactyl-release.zip .
          cd ..

      - name: Get version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: pterodactyl-release.zip
          body: |
            ## üöÄ Production Release ${{ steps.version.outputs.VERSION }}

            –ì–æ—Ç–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

            ### –£—Å—Ç–∞–Ω–æ–≤–∫–∞:

            1. –°–∫–∞—á–∞–π `pterodactyl-release.zip`
            2. –†–∞—Å–ø–∞–∫—É–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            3. –í—ã–ø–æ–ª–Ω–∏:
               ```bash
               cd pterodactyl
               npm install --production
               cp .env.example .env  # –ù–∞—Å—Ç—Ä–æ–π .env
               node app.js
               ```

            ### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tebex —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Headless API
            - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
            - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
